## Environment
The experiment is set with Python 3.8.5 and cuda11.1. Dependency packages are in requirement.txt, you could use `pip` to install:

```{bash}
(envforcone)$ pip install -r requirements.txt
```

## Data
CONE uses data from HotelRec(https://github.com/Diego999/HotelRec) and VAD(https://github.com/somethingx1202/VADet).


## Preprocessing
Preprocessed data for HotelRec in [data/hotel/]:
```{bash}
(envforcone)$ python clean_hotel.py
(envforcone)$ python aug_translate.py
```
Similar for VAD.

To include a customized data set, first create a repo `data/{dataset_name}/clean`. The
following four files must be inside this folder:

* `reviews.txt`: a `[num_sentences]` -length file where each line being
  one sentence in the corpus.
* `reviews_aug_tran.txt`: a `[num_sentences]` -length file where each line being
  the corresponding augmented sentence.
* `sentiments.npy`: a `[num_sentences]` -length file where each line denotes
  the corresponding sentiment pseudo label.

The following files can be inside this folder if available:
* `document_rating.npy`: a `[num_document]` -length file where each line denotes
  the corresponding sentiment label.
* `documents.npy`: a `[num_sentences]` -length file where each line denotes
  the corresponding document index.
* `hotels.npy`: a `[num_sentences]` -length file where each line denotes
  the corresponding hotel index. 
  Such information could also be other labels, such as user, brand, etc.

## Training & Evaluation
Run CONE.py with the command:
```{bash}
(envforcone)$ python CONE.py --to_evaluate "true"
```

## Example output
`aspectsplit` is the popularity of the topic.
For `sentimentsplit`, 0 represents negative, 1 represents positive. `percentage` is the corresponding proportion of the sentiment.

HotelRec:
* *{'aspectsplit': 0.03829713493530499, 'sentimentsplit': {0: {'percentage': 0.92, 'keypoint': ['These go at least every  seconds around the building and are incredibly noisy to the point where the room shakes.\n', 'One of our rooms was directly facing the outdoor stage where the band performed every night...LOUDLY.\n', 'What was supposed to be a quiet break left me exhausted!!!!!!!\n']}, 1: {'percentage': 0.08, 'keypoint': ['Once you were inside it was really quiet, I think being out the back was a good thing.\n', 'I was in , quite quiet and a good size too.\n', 'Everything was in walking distance but not under your nose so it was quiet most of the time!\n']}}}*
* *{'aspectsplit': 0.046918322550831795, 'sentimentsplit': {0: {'percentage': 0.32, 'keypoint': ['The breakfast was under par all squashed in a small room.the presentation of the breakfast was not good squashed in an alcove.\n', 'Breakfast was served until -am but at -am all the eggs and bacon were gone and no one around to get more very disorganised.\n', 'Breakfast was low quality and guests had to wait several times for it to be refilled.\n']}, 1: {'percentage': 0.68, 'keypoint': ['We received an nice restaurant coupon, so we went out for breakfast, although their breakfast offering looked appealing.\n', 'Yes, it was larger and yes they brought us breakfast (I usually went to get it myself for the family, no big deal.\n', 'Breakfast was ok, with a choice of biscuits and gravy or a waffle as your hot dish.\n']}}}*
* *{'aspectsplit': 0.07192987523105361, 'sentimentsplit': {0: {'percentage': 0.98, 'keypoint': ['Were very tight with towels and toilet paper for some reason.\n', 'Another plus point for me was the washer/dryer in the unit.\n', "YOU CAN'T CLEAN THE PUBIC HAIRS ON THE WALL UNLESS YOU CAN SEE THEM!\n"]}, 1: {'percentage': 0.02, 'keypoint': ['it sounds contra intuitive that the longer you stay the less cleaning and less clean linen/towels you need.\n']}}}*
* *{'aspectsplit': 0.0553800831792976, 'sentimentsplit': {0: {'percentage': 0.86, 'keypoint': ["The one downside was the bed - it's a bit short and the linens used were not the most comfy.\n", 'There was a very wide mirror on the wall facing the bed.\n', 'The pillows were as flat as a folded towel, bring your own if you stay here.\n']}, 1: {'percentage': 0.14, 'keypoint': ['Though the bed was very comfortable and the view was great.\n', 'Loved the touch with the sleeping bags as decor/extra warmth on the bed.\n', 'The usual "rubber" pillows, but from long experience we\'ve learned to bring our own, so the pillows weren\'t a problem.\n', ]}}}*
* *{'aspectsplit': 0.04475219500924214, 'sentimentsplit': {0: {'percentage': 0.22, 'keypoint': ['The waitress stood staring at us again, it was very uncomfortable (same one, with the blonde hair) The reception staff were very nice...no complaints there.\n', 'Reception staff are mostly very rude and lazy towards british guests but cannot do enough for the portuguese and french guests.\n', 'Staff is not really accomodating - they cant help you make reservations or book tours, or if they can help, they arent willing.\n']}, 1: {'percentage': 0.78, 'keypoint': ['In addition Jon (flacco) and the rest of the grounds crew, including housekeeping are equally friendly.\n', 'Again if you want excellent well trained staff visit the Auchrannie!.\n', 'All of the staff did their utmost to make me feel right at home, and treated other guests with deference as well.\n']}}}*
* *{'aspectsplit': 0.06836298521256931, 'sentimentsplit': {0: {'percentage': 0.36, 'keypoint': ['The food would have been fine had it not been left on the counter for several minutes and allowed to go cold before being served.\n', 'One evening went down to dinner the lamb dish was gravy and bones, deserts boring - you had to be in the dining room dead on pm to get anything.\n', 'Upon arrival we find the hot stuff is gone and not enough other food to feed  person let alone  of us.\n']}, 1: {'percentage': 0.64, 'keypoint': ['He soon brought out the order & the various items included were very good, but I felt so embarrassed at the whole scene that it was not a relaxing meal.\n', 'Spacious rooms, a rather dull selection for lunch and dinner, but i guess there is a limit to how exciting you want to make a buffet for cheap holiday makers like us.\n', 'The wedding itself went off without a hitch, and the food was the best I have ever had at a wedding!\n']}}}*
* *{'aspectsplit': 0.09669651109057301, 'sentimentsplit': {0: {'percentage': 0.82, 'keypoint': ['When Anyting was brought to their attention I was met with resistence.\n', 'No this is not a spelling error I do mean offal.\n', 'Like, one lady had to go to a clinic to get cortisone shots.\n']}, 1: {'percentage': 0.18, 'keypoint': ['I think I may have found a new favourite in Paris.\n', 'God only knows how it has managed to achieve such good scoring.\n', 'We took a great quality, easy to use SLR camera with us and one of the staff happily took pictures for us but they were nearly all out of focus.\n']}}}*
* *{'aspectsplit': 0.027004390018484287, 'sentimentsplit': {0: {'percentage': 0.34, 'keypoint': ['The chairs near the swimming pool were not enough and to close to each other.\n', 'Looking out the window of our room onto the Marriott pool made our kids drool!\n', "The pool didn't have enough chairs - they were all taken despite fairly cool weather.\n"]}, 1: {'percentage': 0.66, 'keypoint': ['The last one is worth describing - a  meters long proper swimming pool, several water slides, nice chillout room, salt cave, several saunas and therapeutic jacuzzis.\n', "I didn't use the pool or fitness center but they looked nice.\n", 'They have now also opened the pool bar which is a welcome addition.They also have alot more western channels on the tv for when you are actually in the room.\n']}}}*
* *{'aspectsplit': 0.05145274953789279, 'sentimentsplit': {0: {'percentage': 0.78, 'keypoint': ['I would have paid the extra to stay at another competing chain had I known the low level of quality of amenities.\n', 'Unfortunately as we were on a DBB rate this made no difference, it was all under our allowance.\n', 'I found the accommodations to be generally in line with the cost.\n']}, 1: {'percentage': 0.22, 'keypoint': ['Also, make sure you have small bills on you at all times!\n', 'For shopping, would give one piece of advice – bargain a lot!\n', 'It is worth buying  tickets at €. each (as at Sep/Oct ), one for the trip into town and  for the return.\n']}}}*
* *{'aspectsplit': 0.062456677449168205, 'sentimentsplit': {0: {'percentage': 0.52, 'keypoint': ["Couldn't fault anything, I would definitely recommend this hotel, very good value.\n", 'Ahhh...I thought this is a new Inn/Hotel.. First impression was not bad, although they messed up my reservation.\n', 'Where to start with this hotel, it is absolutely no joke when I say this property is horrendous.\n']}, 1: {'percentage': 0.48, 'keypoint': ["Highly recommended if you're looking for something different and do not expect your standard hotel.\n", 'Those are my recommendations but any other hotel will be better.\n', 'Would recommend this property only if you are exhausted of all options of a budget hotel in Candolim.\n']}}}*
* *{'aspectsplit': 0.06740988909426987, 'sentimentsplit': {0: {'percentage': 0.1, 'keypoint': ['the village was just one street with very little to warrant a visit.\n', "It's just a few minutes to the nd street subway, The Dakota where Lennon was shot, Central Park and Strawberry Fields.\n", 'Not in the city center - but who needs the city center of Perm?\n']}, 1: {'percentage': 0.9, 'keypoint': ["The only pros: The location is good for walking (don't get a cab from the hotel, walk to Syntagma it will save a lot of money by avoiding one-way streets).\n", "First, it's in a decent location if you have business or relatives in the Larkspur or San Rafael area.\n", "It's a short stroll from the Blue mosque, hagia sofia, little hagia sofia, grand bazaar & topkapi.\n"]}}}*


VAD:
* *{'aspectsplit': 0.042033920940170943, 'sentimentsplit': {0: {'percentage': 0.18, 'keypoint': ['A CANADIAN federal panel NACI that has advised the feds since 1964 on vaccine issues that expressed the findings concerning the AstraZeneca vaccine but sure dumbass , flail away about other countries while accussing Opposition of stoking fear . #cdnpoli #canpoli\n', "Nearly 400000 AstraZeneca Vaccine Doses Seized in Italy After Teacher’s Death BY JACK PHILLIPS March 15 , 2021 Updated : March 15 , 2021 Covid Beware : Research It's Your Life\n", '“The Biden administration is refusing to allow AstraZeneca to export tens of millions of unused doses of its COVID19 vaccine , despite a plea from the Canadian government to import the shots in a bid to bolster Ottawa’s lagging inoculation drive . #cdnpoli\n']}, 1: {'percentage': 0.82, 'keypoint': ['BREAKING : Health Canada greenlights U . S . batch of AstraZeneca COVID19 vaccine #cdnpoli\n', 'BREAKING U . S . plans to send 1 . 5M doses of AstraZeneca COVID19 vaccine to Canada : report #cdnpoli\n', 'The Biden admin is considering sending some AstraZeneca Covid19 vaccine doses stockpiled waiting for official usage approval in the US over the border to Mexico Canada , per a sr admin official . They may propose a swap agreement , story :\n']}}}*
* *{'aspectsplit': 0.05842681623931624, 'sentimentsplit': {0: {'percentage': 0.72, 'keypoint': ['wish they just suppressed this effectively and vaxxed within that context instead of vaxxing to rescue several ago cohorts\n', 'She has no problem with her colleagues nor they with her apparently . It’s apartheid on the way; canteens for the vaccinated and rooms or whatever for the unvaccinated\n', 'Your right to remain unvaccinated a right to operate as a deadly disease vector in public spaces\n']}, 1: {'percentage': 0.28, 'keypoint': ['And how are the vaxed going to know who the great Unvaccinated are\n', '“May” means the potential spread of the virus to you from the unvaccinated . I am fully vaccinated; therefore , believe you me , I “shall” continue to wear my mask around unvaccinated vaccinated . The CDC issued “guidelines” designed to “minimize” not “prevent” the spread .\n','The CDC’s official new guidelines for vaccinated people are basically no different from the ones for unvaccinated people lol this is all a scam\n']}}}*
* *{'aspectsplit': 0.04784321581196581, 'sentimentsplit': {0: {'percentage': 1.0, 'keypoint': ['The UK has both a strategic partnership and a contract with both signed quite some time ago . The EU have a vaccine mess .\n', 'Petty , nasty , arrogant . Every day I’m grateful we left . “THE European Commission has boasted about its vaccine export controls after it confirmed a vaccine plant in the Netherlands was no longer sending AstraZeneca jabs to Brexit Britain”\n', "And don't count on the vaccine until it's out of the EU's hands lol\n"]}}}*
* *{'aspectsplit': 0.017895299145299144, 'sentimentsplit': {0: {'percentage': 1.0, 'keypoint': ['Just wait until they hear about what birth control pills can do _⊛_starstruck_ BBC News : OxfordAstraZeneca : EU says no indication vaccine linked to clots\n', 'The MHRA has confirmed that people SHOULD continue to receive the Oxford/Astrazeneca covid vaccine , and that available evidence does not suggest that blood closts in veins are caused by the jab .\n','You know what is actually known to increase your risk of thrombosis ? Getting COVID19 . Not sure what EU health leaders are thinking . The study of AZ/Oxford vaccine had almost 24k patients and no thrombosis signal\n']}}}*
* *{'aspectsplit': 0.046774839743589744, 'sentimentsplit': {0: {'percentage': 0.32, 'keypoint': ['its sputnik vaccine scandal 10 dollar vaccine bought for 100+ dollars all hell has broken lose\n', 'Does anybody know what is happening with the Sputnik vaccine ? Is the stock just sitting and rotting in cold storage somewhere ?\n',"Shortly after the UN blamed #France for civilian casualties in #Mali , Russia's Sputnik V vaccine was approved for use in Mali . #Russia's media outlets promote antiFrench narratives in Africa and Moscow tries to boost its soft power in Mali , CAR and #Niger at France's expense\n"]}, 1: {'percentage': 0.68, 'keypoint': ["The developer of Russia's Sputnik V coronavirus vaccine said Friday its shot had been approved for use in the Philippines , becoming the 52nd country to give the green light to the Russian jab . #PolitikoNews\n", '“Those who took the Sputnik V vaccine are assured of their second dose . We are going to work with the importer together with PPB and the vaccination centers to ensure that those who have received the vaccine will get their second dose : Dr . Patrick Amoth\n', 'Ambassador of the Russian Federation to the State of Eritrea A . Yarakhmedov had a meeting with the Commissioner of Culture and Sport of Eritrea Z . Tekle to discuss sending a batch of Sputnik V vaccine for Eritrean athletes . #Eritrea #Russia\n']}}}*
* *{'aspectsplit': 0.02607505341880342, 'sentimentsplit': {1: {'percentage': 1.0, 'keypoint': ['_cross_mark_ No vaccine appointments are available at Aqueduct Racetrack : Racing Hall Pfizer .\n', 'If anyone’s trying to get a vaccine app Javits Center Pfizer still has ~500 slots open\n', "PFIZER VACCINE NO APPT TODAY ONLY : Walgreens at 3201 w 6th st , Los Angeles . “There's a bunch of vaccines and no scheduled appts . They said send anyone and everyone . From a pharmacist friend of mine there .\n"]}}}*
* *{'aspectsplit': 0.0390625, 'sentimentsplit': {0: {'percentage': 0.06, 'keypoint': ['Been two days since my second vaccine Pfizer : my entire arm hurts , the 103 fever I had all yesterday is down to a low grade fever , some body aches and nausea is almost gone _raising_hands_ mediumdark_skin_tone_ _raising_hands_ mediumdark_skin_tone_\n', 'MORNING AFTER vaccine . No real visible effects . My arm , recovering from shoulder surgery is already hurting . I feel like I dodged a bullet . I should get a button that says Survived 1918 in 2020 #Pfizer\n', '8 : 20pm : about 3 . 5 hours since vaccine . Starting to feel some brain fog . Tiredness too but that could be the sheer adrenaline of it all wearing off . #Pfizer #seconddose\n']}, 0: {'percentage': 0.94, 'keypoint': ['Got Pfizer jab 1 yesterday . Had some WEIRD dreams and feel vaguely flattened today but , that could just be my brain as it is anyways . Let’s get this herd immunity going _thumbs_up_\n','Me too ! My mother in law got her Pfizer vaccine last week and she is still alive and well .\n','Damn ! You burst my bubble . I got the Pfizer vaccine too was really looking forward to the 2nd dose . Now all I’ve got to look forward to is headaches intermittent vision loss . _weary_face_\n']}}}*
* *{'aspectsplit': 0.05959535256410257, 'sentimentsplit': {0: {'percentage': 0.98, 'keypoint': ['U . K . Reports 30 Cases Of Rare Blood Clots Linked To #AstraZeneca Vaccine , Insists Benefits Outweigh Any Risks\n', 'U . K . Reports 30 Cases Of Rare Blood Clots Linked To AstraZeneca Vaccine , Insists Benefits Outweigh Any Risks\n', 'This is an excellent and measured article on the subject . First 3 clicks free , then Blood clots and the AstraZeneca Covid vaccine : is there a link ? : via\n']}, 1: {'percentage': 0.02, 'keypoint': ['UK medicines regulator insists #AstraZeneca vaccine safe to use and says no evidence of link to blood clots\n']}}}*
* *{'aspectsplit': 0.04043135683760684, 'sentimentsplit': {0: {'percentage': 0.94, 'keypoint': ['_warning_ VACCINE INJURY STORY _warning_ I got my second moderna dose yesterday and today my pp is bigger handsomer . Please share this with everyone who is sexy . _warning_ VACCINE INJURY STORY _warning_\n','Starting physical therapy , having a pain injection and getting second round Moderna vaccine in the same week pray for my pain and survival . It’s gonna be a lot\n', 'Hello ! What if I had 3 shots of your vaccine ? On 20 . 01 , 01 . 03 and 29 . 03 ? Any trial for me ?\n']}, 1: {'percentage': 0.06, 'keypoint': ['Vaccine Day Two : exhaustion lasted about 12 hours , now just severe nausea . No major arm pain . Moderna , fyi\n', 'I had the same 2nd shot reaction . I had chills and a fever of 100 degrees . Tylenol and lots of water and orange juice helped . I had the Moderna vaccine .\n', 'Vaccine Moderna dose 2 update . dizzy , mild chills , average headache , definitely fatigued . Small price to pay to get back on the road and play concerts and hug my friends again . _red_heart_\n']}}}*
* *{'aspectsplit': 0.029246794871794872, 'sentimentsplit': {1: {'percentage': 1.0, 'keypoint': ['Pfizer says Covid vaccine 100 percent effective in children ages 12 to 15 : NBC News Pfizer says Covid vaccine 100 percent effective in children ages 12 to 15 NBC News COVID arm Moderna side effect , no cause for alarm KHON2 NewsAfter About 50 Years , th\n','#Covidvaccine : #Pfizer says jab is 100% effective in kids aged 1215\n','Pfizer said its Covid19 vaccine was 100% effective in kids ages 1215 . The results could lead to inoculations before the next school year . corrects link\n']}}}*